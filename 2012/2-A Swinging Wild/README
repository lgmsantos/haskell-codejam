Haskell solution to the problem http://goo.gl/PzNf4 (v2 almost solve the large input)